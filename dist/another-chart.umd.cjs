(function(p){typeof define=="function"&&define.amd?define(p):p()})(function(){"use strict";var bt=Object.defineProperty;var ot=p=>{throw TypeError(p)};var ft=(p,g,A)=>g in p?bt(p,g,{enumerable:!0,configurable:!0,writable:!0,value:A}):p[g]=A;var z=(p,g,A)=>ft(p,typeof g!="symbol"?g+"":g,A),it=(p,g,A)=>g.has(p)||ot("Cannot "+A);var r=(p,g,A)=>(it(p,g,"read from private field"),A?A.call(p):g.get(p)),w=(p,g,A)=>g.has(p)?ot("Cannot add the same private member more than once"):g instanceof WeakSet?g.add(p):g.set(p,A),u=(p,g,A,Q)=>(it(p,g,"write to private field"),Q?Q.call(p,A):g.set(p,A),A);var P,N,F,J,D,j,Z,q,R,U,W,B,X,O,Y,G,K,$,I;class p extends HTMLElement{constructor(){super(...arguments);z(this,"data",[]);z(this,"color","rgba(46, 204, 113, 0.9)");z(this,"parent")}connectedCallback(){this.parent=this.parentNode,this.attachShadow({mode:"open"}).innerHTML="<slot></slot>"}static get observedAttributes(){return["data","color"]}attributeChangedCallback(t,e,s){e!==s&&(t==="data"&&(this.data=JSON.parse(s||"[]")),t==="color"&&(this.color=s||"rgba(46, 204, 113, 0.9)"),this.render())}updateData(t){this.data=JSON.parse(this.getAttribute("data")||"[]"),this.color=this.getAttribute("color")||t}forceResize(){this.render()}render(){var b,L;if(!this.parent)return;const t=(L=(b=this.parentElement)==null?void 0:b.shadowRoot)==null?void 0:L.querySelector("canvas"),e=t.getContext("2d"),s=window.devicePixelRatio||1,i=t.width/s,l=t.height/s,o=this.parent.getGlobals(),C=this.parent.getNumberOfValues();let f=o.min,y=o.max;this.parent.beginAtZero()&&(f=Math.min(0,o.min),y=Math.max(0,o.max));const d=this.parent.getCenter(),_=(y-f||1)/10,E=Math.pow(10,Math.floor(Math.log10(_))),h=_/E;let S;h<=1?S=1:h<=2?S=2:h<=4?S=5:S=10;const c=S*E,v=Math.floor(f/c)*c,M=Math.ceil(y/c)*c;Array.from(this.children).forEach(T=>{typeof T.draw=="function"&&T.draw(e,i,l,this.data.slice(0,C),v,M,C,this.color,d)})}}function g(a){if(!a)return;if(a=a.trim(),a.startsWith("#")){let t=a.replace(/^#/,"");t.length===3?t=t.split("").map(o=>o+o).join(""):t.length===4&&(t=t.split("").map(o=>o+o).join(""));const e=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),l=t.length===8?parseInt(t.substring(6,8),16)/255:1;return`rgba(${e}, ${s}, ${i}, ${l})`}const n=a.match(/rgba?\(([^)]+)\)/);if(n){let[t,e,s,i=1]=n[1].split(",").map(l=>l.trim());return`rgba(${parseInt(t)}, ${parseInt(e)}, ${parseInt(s)}, ${parseFloat(i)})`}throw new Error("Unsupported color format")}function A(a){const n=["rgba(34, 197, 94, 0.9)","rgba(239, 68, 68, 0.9)","rgba(59, 130, 246, 0.9)","rgba(251, 146, 60, 0.9)","rgba(236, 72, 153, 0.9)","rgba(132, 204, 22, 0.9)","rgba(14, 165, 233, 0.9)","rgba(168, 85, 247, 0.9)","rgba(250, 204, 21, 0.9)","rgba(20, 184, 166, 0.9)"];return n[a%n.length]}function Q(a,n,t,e,s){if(!n||!t){console.warn("[AC Tooltip] Canvas or tooltip element not found.");return}const i=n.getBoundingClientRect(),l=a.clientX-i.left,o=a.clientY-i.top,C=Array.from(e.querySelectorAll("ac-data-set")),f=e.getNumberOfValues(),{min:y,max:d}=e.getGlobals(),k=e.getLabels(),m={top:20,bottom:30,left:40,right:20},_=n.clientWidth,E=n.clientHeight,h=_-m.left-m.right,S=E-m.top-m.bottom,c=(l-m.left)/h;if(c<0||c>1){t.style.display="none";return}const v=Math.floor(c*f),M=Math.max(0,Math.min(f-1,v)),b=[`<div>${k[M]}</div>`];let L=0,T=0,x=!1;if(C.forEach((H,tt)=>{const et=JSON.parse(H.getAttribute("data")||"[]")[M];if(et==null)return;const gt=H.getAttribute("label")||`Dataset ${tt+1}`,ut=g(H.getAttribute("color"))??A(tt);b.push(`<div><span style="color:${ut};">‚óè</span> ${gt}: ${et}</div>`),x||(L=m.left+M/(f-1)*h,T=m.top+S*(1-(et-y)/(d-y)),x=!0)}),s==="mouse"){b.length?(t.innerHTML=b.join(""),t.style.left=`${l+10}px`,t.style.top=`${o+10}px`,t.style.display="block"):t.style.display="none";return}b.length&&x?(t.innerHTML=b.join(""),t.style.left=`${L+10}px`,t.style.top=`${T-30}px`,t.style.display="block"):t.style.display="none"}class nt extends HTMLElement{constructor(){super(...arguments);w(this,P,"point");w(this,N);w(this,F);w(this,J);z(this,"_tooltip")}static get observedAttributes(){return["position"]}connectedCallback(){var t,e,s;if(u(this,P,this.getAttribute("position")||"point"),u(this,F,(t=this.parentElement)==null?void 0:t.shadowRoot),u(this,J,this.parentElement),!r(this,F)){console.error("[AC Tooltip] Tooltip must be a child of another-chart with a shadow root.");return}u(this,N,(s=(e=this.parentElement)==null?void 0:e.shadowRoot)==null?void 0:s.querySelector("canvas")),this._tooltip=document.createElement("div"),this._tooltip.className="another-chart__tooltip",r(this,P)==="point"&&this._tooltip.classList.add("another-chart__tooltip--animate"),r(this,F).appendChild(this._tooltip),r(this,N).addEventListener("mousemove",i=>this.handleMouseMove(i)),r(this,N).addEventListener("mouseleave",()=>{this._tooltip&&(this._tooltip.style.display="none")})}handleMouseMove(t){Q(t,r(this,N),this._tooltip,r(this,J),r(this,P))}attributeChangedCallback(t,e,s){e!==s&&t==="position"&&(u(this,P,s||"point"),this._tooltip&&this._tooltip.classList.toggle("another-chart__tooltip--animate",r(this,P)==="point"))}}P=new WeakMap,N=new WeakMap,F=new WeakMap,J=new WeakMap;class rt extends HTMLElement{constructor(){super(...arguments);w(this,D);w(this,j);w(this,Z,"bottom");z(this,"_legend")}static get observedAttributes(){return["position"]}connectedCallback(){var t;if(u(this,D,(t=this.parentElement)==null?void 0:t.shadowRoot),u(this,j,this.parentElement),u(this,Z,this.getAttribute("position")||"bottom"),!r(this,D)){console.warn("[AC Legend] Legend must be a child of another-chart with a shadow root.");return}this._legend=document.createElement("div"),this._legend.className="another-chart__legend",r(this,Z)==="top"&&this._legend.classList.add("another-chart__legend--top"),r(this,D).appendChild(this._legend),setTimeout(()=>{this.renderLegends()},0)}renderLegends(){if(!r(this,j)){console.error("[AC Legend] Legend must be a child of another-chart.");return}const t=Array.from(r(this,j).querySelectorAll("ac-data-set"));this._legend&&(this._legend.innerHTML="",t.forEach((e,s)=>{const i=e.getAttribute("label")||`Dataset ${s+1}`,l=g(e.getAttribute("color"))??A(s),o=document.createElement("div");o.className="legend__item";const C=document.createElement("div");C.className="legend__color",C.style.backgroundColor=l;const f=document.createElement("span");f.textContent=i??`Dataset ${s+1}`,o.appendChild(C),o.appendChild(f),this._legend.appendChild(o)}))}}D=new WeakMap,j=new WeakMap,Z=new WeakMap;function at(a,n,t,e,s,i,l=!1){const o=V(),C=e-(o.top+o.bottom),f=window.devicePixelRatio||1;a.width=t*f,a.height=e*f,n.setTransform(1,0,0,1,0,0),n.scale(f,f),n.clearRect(0,0,t,e),l&&(s>0&&(s=0),i<0&&(i=0));const y=i-s;if(y===0)return;let k=y/10;const m=Math.pow(10,Math.floor(Math.log10(k))),_=k/m;let E;_<=1?E=1:_<=2?E=2:_<=4?E=5:E=10;const h=E*m,S=Math.floor(s/h)*h,c=Math.ceil(i/h)*h,v=new Set;for(let x=S;x<=c+h/2;x+=h)v.add(Number(x.toFixed(10)));const M=Array.from(v).sort((x,H)=>H-x);n.font="12px sans-serif",n.fillStyle="#666666",n.textAlign="right",n.textBaseline="middle";const b=5,L=x=>o.top+(c-x)/(c-S)*C;n.strokeStyle="#e5e5e5",n.lineWidth=1,M.forEach(x=>{const H=Math.round(L(x))+.5;n.beginPath(),n.moveTo(o.left+.5,H),n.lineTo(t-o.right,H),n.stroke(),n.fillText(x.toFixed(Number.isInteger(h)?0:1),o.left-b,H)});const T=o.left+.5;n.beginPath(),n.moveTo(T,o.top),n.lineTo(T,e-o.bottom),n.stroke(),n.beginPath(),n.moveTo(t-o.right,o.top),n.lineTo(t-o.right,e-o.bottom),n.stroke()}function lt(a,n,t,e,s=!0){const i=V(),l=n-i.left-i.right,o=10,C=e.length,f=C-1;if(a.fillStyle="#666",a.font="12px sans-serif",a.textAlign="center",a.textBaseline="top",a.lineWidth=1,s){const y=l/C;for(let d=0;d<C;d++){const k=i.left+y*(d+.5);if(d<f){const m=i.left+y*(d+1);a.strokeStyle="#e5e5e5",a.beginPath(),a.moveTo(m,i.top),a.lineTo(m,t-o-20),a.stroke()}a.fillText(e[d],k,t-o-10)}}else for(let y=0;y<=f;y++){const d=i.left+l/f*y;a.strokeStyle="#e5e5e5",a.beginPath(),a.moveTo(d,i.top),a.lineTo(d,t-o-20),a.stroke(),a.fillText(e[y],d,t-o-10)}}function V(a){const n={top:10,right:20,bottom:30,left:50};return{top:n.top+0,right:n.right+0,bottom:n.bottom+0,left:n.left+0}}class ht extends HTMLElement{constructor(){super(...arguments);w(this,q);w(this,R,"auto");w(this,U,10)}connectedCallback(){u(this,R,this.getAttribute("width")??"auto"),u(this,q,this.getAttribute("color")||void 0),u(this,U,parseFloat(this.getAttribute("space")||"10"))}static get observedAttributes(){return["color","bar-width"]}attributeChangedCallback(t,e,s){e!==s&&(t==="color"&&u(this,q,s||void 0),t==="bar-width"&&u(this,R,s??"auto"))}draw(t,e,s,i,l,o,C,f){const y=C??i.length,d=V(),k=e-(d.left+d.right),m=s-(d.top+d.bottom),_=o-l||1;t.save(),t.translate(d.left+.5,d.top+.5);const E=k/y,h=r(this,R)!=="auto"?0:r(this,U)??0,S=r(this,R)==="auto"?E-h:Math.min(parseFloat(r(this,R)),E-h);t.fillStyle=g(r(this,q)??f??"black");const c=(0-l)/_*m;i.forEach((v,M)=>{const b=M*E+(E-S)/2,L=Math.abs(v)/_*m,T=v>=0?m-(v-l)/_*m:m-c;t.fillRect(b,T,S,L),this.dispatchEvent(new CustomEvent("register-click-area",{detail:{x:b+d.left,y:T+d.top,width:S,height:L,value:v},bubbles:!0,composed:!0}))}),t.restore()}}q=new WeakMap,R=new WeakMap,U=new WeakMap;class ct extends HTMLElement{constructor(){super(...arguments);w(this,W);w(this,B,0);w(this,X,2)}connectedCallback(){u(this,B,parseFloat(this.getAttribute("tension")||"0")),u(this,X,parseFloat(this.getAttribute("width")??"")||1),u(this,W,this.getAttribute("color")||void 0)}static get observedAttributes(){return["tension","color","width"]}attributeChangedCallback(t,e,s){e!==s&&(t==="color"&&u(this,W,s||void 0),t==="tension"&&u(this,B,parseFloat(this.getAttribute("tension")||"0")),t==="width"&&u(this,X,parseFloat(this.getAttribute("width")??"")||1))}draw(t,e,s,i,l,o,C,f,y=!0){const d=C??i.length;i.length;const k=V(),m=e-(k.left+k.right),_=s-(k.top+k.bottom);t.save(),t.translate(k.left+.5,k.top+.5),t.lineWidth=r(this,X);const E=o-l||1;let h;if(y){const c=m/d;h=i.map((v,M)=>{const b=c*(M+.5),L=_-(v-l)/E*_;return{x:b,y:Math.max(0,Math.min(_,L))}})}else h=i.map((c,v)=>{const M=v/(d-1)*m,b=_-(c-l)/E*_;return{x:M,y:Math.max(0,Math.min(_,b))}});t.strokeStyle=g(r(this,W)??f??"black"),t.beginPath(),t.moveTo(h[0].x,h[0].y);for(let c=0;c<h.length-1;c++){const v=h[c-1]||h[c],M=h[c],b=h[c+1],L=h[c+2]||b,T=r(this,B),x=M.x+(b.x-v.x)*T/6,H=M.y+(b.y-v.y)*T/6,tt=b.x-(L.x-M.x)*T/6,st=b.y-(L.y-M.y)*T/6;t.bezierCurveTo(x,H,tt,st,b.x,b.y)}t.stroke(),t.fillStyle=g(r(this,W)??f??"black");const S=4;h.forEach(({x:c,y:v})=>{t.beginPath(),t.arc(c,v,S,0,2*Math.PI),t.fill()}),t.restore()}}W=new WeakMap,B=new WeakMap,X=new WeakMap;const dt=`
    :host {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    :host:has(.another-chart__legend--top) {
      flex-direction: column-reverse;
    }
    canvas {
      width: 100%;
      flex: 1;
      min-height: 0px;
    }
    .another-chart__legend {
    width: 100%;
    padding: 6px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    font-size: 12px;
    font-family: sans-serif;
  }
  .legend__item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .legend__color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  
  .another-chart__tooltip { 
      position: absolute;
      background: #666;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
      z-index: 10;
      display: none;
      font-family: sans-serif;
    }
    .another-chart__tooltip--animate {
      transition: all ease .2s;
    }
  `;class pt extends HTMLElement{constructor(){super();w(this,O,[]);w(this,Y,!1);w(this,G,!1);w(this,K,[]);w(this,$);w(this,I);z(this,"_observer");z(this,"_resizeObserver");this.attachShadow({mode:"open"}),this.setupElements(),this.setupObservers(),this.setupListeners()}static get observedAttributes(){return["labels"]}setupElements(){var s;const t=document.createElement("style");t.textContent=dt,u(this,$,document.createElement("canvas")),u(this,I,r(this,$).getContext("2d"));const e=document.createElement("slot");(s=this.shadowRoot)==null||s.append(t,r(this,$),e)}setupObservers(){this._observer=new MutationObserver(()=>this.renderAllCharts()),this._observer.observe(this,{childList:!0,subtree:!0,attributes:!0}),this._resizeObserver=new ResizeObserver(()=>this.renderAllCharts()),this._resizeObserver.observe(this)}setupListeners(){this.addEventListener("register-click-area",t=>{const e=t.detail;r(this,K).push(e)}),r(this,$).addEventListener("click",this.handleClick.bind(this))}connectedCallback(){u(this,O,(this.getAttribute("labels")??"").split(",").map(t=>t.trim())),u(this,Y,(this.getAttribute("begin-at-zero")??this.getAttribute("beginAtZero")??"true")==="true"),setTimeout(()=>this.renderAllCharts(),0)}attributeChangedCallback(t,e,s){if(console.log(`Attribute changed: ${t} from ${e} to ${s}`),!(!r(this,$)||!r(this,I))&&e!==s&&t==="labels"){const i=(s??"").split(",").map(o=>o.trim()),l=i.length===r(this,O).length;if(u(this,O,i),l){this.drawScales();return}this.renderAllCharts()}}disconnectedCallback(){this._observer&&this._observer.disconnect(),this._resizeObserver&&this._resizeObserver.disconnect()}handleClick(t){const e=r(this,$).getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,l=r(this,K).find(o=>s>=o.x&&s<=o.x+o.width&&i>=o.y&&i<=o.y+o.height);l&&(console.log("Clicked value:",l.value),this.dispatchEvent(new CustomEvent("value-click",{detail:{value:l.value},bubbles:!0,composed:!0})))}renderAllCharts(){const t=Array.from(this.querySelectorAll("ac-data-set"));u(this,G,Array.from(this.querySelectorAll("ac-bar-chart")).length>0),t.forEach((e,s)=>{var i;return(i=e.updateData)==null?void 0:i.call(e,A(s))}),this.drawScales(),t.forEach((e,s)=>{var i;return(i=e.forceResize)==null?void 0:i.call(e)})}drawScales(){const t=r(this,$).clientWidth??800,e=r(this,$).clientHeight??400;at(r(this,$),r(this,I),t,e,this.getGlobals().min,this.getGlobals().max,r(this,Y)),lt(r(this,I),t,e,r(this,O),r(this,G))}beginAtZero(){return r(this,Y)}getNumberOfValues(){var t;return((t=r(this,O))==null?void 0:t.length)??0}getLabels(){return r(this,O)}getCenter(){return r(this,G)}getGlobals(){let t=[];Array.from(this.children).forEach(i=>{var o;const l=JSON.parse(i.getAttribute("data")||"[]");t.push(...l.slice(0,((o=r(this,O))==null?void 0:o.length)||l.length))});const e=t.length?Math.min(...t):0,s=t.length?Math.max(...t):0;return{min:e,max:s}}}O=new WeakMap,Y=new WeakMap,G=new WeakMap,K=new WeakMap,$=new WeakMap,I=new WeakMap,customElements.define("another-chart",pt),customElements.define("ac-data-set",p),customElements.define("ac-line-chart",ct),customElements.define("ac-tooltip",nt),customElements.define("ac-legend",rt),customElements.define("ac-bar-chart",ht)});
