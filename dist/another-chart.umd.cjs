(function(p){typeof define=="function"&&define.amd?define(p):p()})(function(){"use strict";var ut=Object.defineProperty;var st=p=>{throw TypeError(p)};var ft=(p,u,E)=>u in p?ut(p,u,{enumerable:!0,configurable:!0,writable:!0,value:E}):p[u]=E;var z=(p,u,E)=>ft(p,typeof u!="symbol"?u+"":u,E),ot=(p,u,E)=>u.has(p)||st("Cannot "+E);var i=(p,u,E)=>(ot(p,u,"read from private field"),E?E.call(p):u.get(p)),y=(p,u,E)=>u.has(p)?st("Cannot add the same private member more than once"):u instanceof WeakSet?u.add(p):u.set(p,E),f=(p,u,E,V)=>(ot(p,u,"write to private field"),V?V.call(p,E):u.set(p,E),E);var P,N,D,J,F,j,Z,q,R,U,W,B,X,H,G,Y,K,x,I;class p extends HTMLElement{constructor(){super(...arguments);z(this,"data",[]);z(this,"color","rgba(46, 204, 113, 0.9)");z(this,"parent")}connectedCallback(){this.parent=this.parentNode,this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.updateData()}static get observedAttributes(){return["data","color"]}attributeChangedCallback(t,e,s){e!==s&&(t==="data"&&(this.data=JSON.parse(s||"[]")),t==="color"&&(this.color=s||"rgba(46, 204, 113, 0.9)"),this.render())}updateData(){this.data=JSON.parse(this.getAttribute("data")||"[]"),this.color=this.getAttribute("color")||"rgba(46, 204, 113, 0.9)"}forceResize(){this.render()}render(){var g,$;if(!this.parent)return;const t=($=(g=this.parentElement)==null?void 0:g.shadowRoot)==null?void 0:$.querySelector("canvas"),e=t.getContext("2d"),s=window.devicePixelRatio||1,r=t.width/s,h=t.height/s,o=this.parent.getGlobals(),_=this.parent.getNumberOfValues(),b=this.parent.beginAtZero()?0:o.min,w=this.parent.getCenter(),c=o.max,M=(c-b||1)/10,C=Math.pow(10,Math.floor(Math.log10(M))),l=M/C;let S;l<=1?S=1:l<=2?S=2:l<=4?S=5:S=10;const d=S*C,m=Math.floor(b/d)*d,v=Math.ceil(c/d)*d;Array.from(this.children).forEach(L=>{typeof L.draw=="function"&&L.draw(e,r,h,this.data.slice(0,_),m,v,_,this.color,w)})}}function u(a){if(!a)return"rgba(0, 0, 0, 1)";if(a=a.trim(),a.startsWith("#")){let t=a.replace(/^#/,"");t.length===3?t=t.split("").map(o=>o+o).join(""):t.length===4&&(t=t.split("").map(o=>o+o).join(""));const e=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16),h=t.length===8?parseInt(t.substring(6,8),16)/255:1;return`rgba(${e}, ${s}, ${r}, ${h})`}const n=a.match(/rgba?\(([^)]+)\)/);if(n){let[t,e,s,r=1]=n[1].split(",").map(h=>h.trim());return`rgba(${parseInt(t)}, ${parseInt(e)}, ${parseInt(s)}, ${parseFloat(r)})`}throw new Error("Unsupported color format")}function E(a,n,t,e,s){if(!n||!t){console.warn("[AC Tooltip] Canvas or tooltip element not found.");return}const r=n.getBoundingClientRect(),h=a.clientX-r.left,o=a.clientY-r.top,_=Array.from(e.querySelectorAll("ac-data-set")),b=e.getNumberOfValues(),{min:w,max:c}=e.getGlobals(),k=e.getLabels(),A={top:20,bottom:30,left:40,right:20},M=n.clientWidth,C=n.clientHeight,l=M-A.left-A.right,S=C-A.top-A.bottom,d=(h-A.left)/l,m=Math.round(d*(b-1));if(m<0||m>=b){t.style.display="none";return}const v=[];let g=0,$=0,L=!1;if(_.forEach((T,O)=>{const Q=JSON.parse(T.getAttribute("data")||"[]")[m];if(Q==null)return;const dt=T.getAttribute("label")||`Dataset ${O+1}`,pt=u(T.getAttribute("color"));v.push(`<div><div>${k[m]}</div><span style="color:${pt};">‚óè</span> ${dt}: ${Q}</div>`),L||(g=A.left+m/(b-1)*l,$=A.top+S*(1-(Q-w)/(c-w)),L=!0)}),s==="mouse"){v.length?(t.innerHTML=v.join(""),t.style.left=`${h+10}px`,t.style.top=`${o+10}px`,t.style.display="block"):t.style.display="none";return}v.length&&L?(t.innerHTML=v.join(""),t.style.left=`${g+10}px`,t.style.top=`${$-30}px`,t.style.display="block"):t.style.display="none"}class V extends HTMLElement{constructor(){super(...arguments);y(this,P,"point");y(this,N);y(this,D);y(this,J);z(this,"_tooltip")}static get observedAttributes(){return["position"]}connectedCallback(){var t,e,s;if(f(this,P,this.getAttribute("position")||"point"),f(this,D,(t=this.parentElement)==null?void 0:t.shadowRoot),f(this,J,this.parentElement),!i(this,D)){console.error("[AC Tooltip] Tooltip must be a child of another-chart with a shadow root.");return}f(this,N,(s=(e=this.parentElement)==null?void 0:e.shadowRoot)==null?void 0:s.querySelector("canvas")),this._tooltip=document.createElement("div"),this._tooltip.className="another-chart__tooltip",i(this,P)==="point"&&this._tooltip.classList.add("another-chart__tooltip--animate"),i(this,D).appendChild(this._tooltip),i(this,N).addEventListener("mousemove",r=>this.handleMouseMove(r)),i(this,N).addEventListener("mouseleave",()=>{this._tooltip&&(this._tooltip.style.display="none")})}handleMouseMove(t){E(t,i(this,N),this._tooltip,i(this,J),i(this,P))}attributeChangedCallback(t,e,s){e!==s&&t==="position"&&(f(this,P,s||"point"),this._tooltip&&this._tooltip.classList.toggle("another-chart__tooltip--animate",i(this,P)==="point"))}}P=new WeakMap,N=new WeakMap,D=new WeakMap,J=new WeakMap;class it extends HTMLElement{constructor(){super(...arguments);y(this,F);y(this,j);y(this,Z,"bottom");z(this,"_legend")}static get observedAttributes(){return["position"]}connectedCallback(){var t;if(f(this,F,(t=this.parentElement)==null?void 0:t.shadowRoot),f(this,j,this.parentElement),f(this,Z,this.getAttribute("position")||"bottom"),!i(this,F)){console.warn("[AC Legend] Legend must be a child of another-chart with a shadow root.");return}this._legend=document.createElement("div"),this._legend.className="another-chart__legend",i(this,Z)==="top"&&this._legend.classList.add("another-chart__legend--top"),i(this,F).appendChild(this._legend),setTimeout(()=>{this.renderLegends()},0)}renderLegends(){if(!i(this,j)){console.error("[AC Legend] Legend must be a child of another-chart.");return}const t=Array.from(i(this,j).querySelectorAll("ac-data-set"));this._legend&&(this._legend.innerHTML="",t.forEach((e,s)=>{const r=e.getAttribute("label")||`Dataset ${s+1}`,h=u(e.getAttribute("color")),o=document.createElement("div");o.className="legend__item";const _=document.createElement("div");_.className="legend__color",_.style.backgroundColor=h;const b=document.createElement("span");b.textContent=r??`Dataset ${s+1}`,o.appendChild(_),o.appendChild(b),this._legend.appendChild(o)}))}}F=new WeakMap,j=new WeakMap,Z=new WeakMap;function nt(a,n,t,e,s,r,h=!1){const o=tt(),_=e-(o.top+o.bottom),b=window.devicePixelRatio||1;a.width=t*b,a.height=e*b,n.setTransform(1,0,0,1,0,0),n.scale(b,b),n.clearRect(0,0,t,e),h&&(s>0&&(s=0),r<0&&(r=0));const w=r-s;if(w===0)return;let k=w/10;const A=Math.pow(10,Math.floor(Math.log10(k))),M=k/A;let C;M<=1?C=1:M<=2?C=2:M<=4?C=5:C=10;const l=C*A,S=Math.floor(s/l)*l,d=Math.ceil(r/l)*l,m=new Set;for(let T=S;T<=d+l/2;T+=l)m.add(Number(T.toFixed(10)));const v=Array.from(m).sort((T,O)=>O-T);n.font="12px sans-serif",n.fillStyle="#666666",n.textAlign="right",n.textBaseline="middle";const g=5,$=T=>o.top+(d-T)/(d-S)*_;n.strokeStyle="#e5e5e5",n.lineWidth=1,v.forEach(T=>{const O=Math.round($(T))+.5;n.beginPath(),n.moveTo(o.left+.5,O),n.lineTo(t-o.right,O),n.stroke(),n.fillText(T.toFixed(Number.isInteger(l)?0:1),o.left-g,O)});const L=o.left+.5;n.beginPath(),n.moveTo(L,o.top),n.lineTo(L,e-o.bottom),n.stroke(),n.beginPath(),n.moveTo(t-o.right,o.top),n.lineTo(t-o.right,e-o.bottom),n.stroke()}function rt(a,n,t,e,s=!0){const r=tt(),h=n-r.left-r.right,o=10,_=e.length,b=_-1;if(a.fillStyle="#666",a.font="12px sans-serif",a.textAlign="center",a.textBaseline="top",a.lineWidth=1,s){const w=h/_;for(let c=0;c<_;c++){const k=r.left+w*(c+.5);if(c<b){const A=r.left+w*(c+1);a.strokeStyle="#e5e5e5",a.beginPath(),a.moveTo(A,r.top),a.lineTo(A,t-o-20),a.stroke()}a.fillText(e[c],k,t-o-10)}}else for(let w=0;w<=b;w++){const c=r.left+h/b*w;a.strokeStyle="#e5e5e5",a.beginPath(),a.moveTo(c,r.top),a.lineTo(c,t-o-20),a.stroke(),a.fillText(e[w],c,t-o-10)}}function tt(a){const n={top:10,right:20,bottom:30,left:50};return{top:n.top+0,right:n.right+0,bottom:n.bottom+0,left:n.left+0}}class at extends HTMLElement{constructor(){super(...arguments);y(this,q);y(this,R,"auto");y(this,U,10)}connectedCallback(){f(this,R,this.getAttribute("width")??"auto"),f(this,q,this.getAttribute("color")||void 0),f(this,U,parseFloat(this.getAttribute("space")||"10"))}static get observedAttributes(){return["color","bar-width"]}attributeChangedCallback(t,e,s){e!==s&&(t==="color"&&f(this,q,s||void 0),t==="bar-width"&&f(this,R,s??"auto"))}draw(t,e,s,r,h,o,_,b){const w=_??r.length,c=tt(),k=e-(c.left+c.right),A=s-(c.top+c.bottom),M=o-h||1;t.save(),t.translate(c.left+.5,s-c.bottom+.5),t.scale(1,-1);const C=k/w,l=i(this,R)!=="auto"?0:i(this,U)??0,S=i(this,R)==="auto"?C-l:Math.min(parseFloat(i(this,R)),C-l);t.fillStyle=u(i(this,q)??b??"black"),r.forEach((d,m)=>{const v=m*C+(C-S)/2,g=(d-h)/M*A;t.fillRect(v,0,S,g),this.dispatchEvent(new CustomEvent("register-click-area",{detail:{x:v+c.left,y:s-c.bottom-g,width:S,height:g,value:d},bubbles:!0,composed:!0}))}),t.restore()}}q=new WeakMap,R=new WeakMap,U=new WeakMap;class lt extends HTMLElement{constructor(){super(...arguments);y(this,W);y(this,B,0);y(this,X,2)}connectedCallback(){f(this,B,parseFloat(this.getAttribute("tension")||"0")),f(this,X,parseFloat(this.getAttribute("width")??"")||1),f(this,W,this.getAttribute("color")||void 0)}static get observedAttributes(){return["tension","color","width"]}attributeChangedCallback(t,e,s){e!==s&&(t==="color"&&f(this,W,s||void 0),t==="tension"&&f(this,B,parseFloat(this.getAttribute("tension")||"0")),t==="width"&&f(this,X,parseFloat(this.getAttribute("width")??"")||1))}draw(t,e,s,r,h,o,_,b,w=!0){const c=_??r.length;r.length;const k=tt(),A=e-(k.left+k.right),M=s-(k.top+k.bottom);t.save(),t.translate(k.left+.5,s-k.bottom+.5),t.scale(1,-1),t.lineWidth=i(this,X);const C=o-h||1;let l;if(w){const d=A/c;l=r.map((m,v)=>{const g=d*(v+.5),$=(m-h)/C*M;return{x:g,y:$}})}else l=r.map((d,m)=>{const v=m/(c-1)*A,g=(d-h)/C*M;return{x:v,y:g}});t.strokeStyle=u(i(this,W)??b??"black"),t.beginPath(),t.moveTo(l[0].x,l[0].y);for(let d=0;d<l.length-1;d++){const m=l[d-1]||l[d],v=l[d],g=l[d+1],$=l[d+2]||g,L=i(this,B),T=v.x+(g.x-m.x)*L/6,O=v.y+(g.y-m.y)*L/6,et=g.x-($.x-v.x)*L/6,Q=g.y-($.y-v.y)*L/6;t.bezierCurveTo(T,O,et,Q,g.x,g.y)}t.stroke(),t.fillStyle=u(i(this,W)??b??"black");const S=4;l.forEach(({x:d,y:m})=>{t.beginPath(),t.arc(d,m,S,0,2*Math.PI),t.fill()}),t.restore()}}W=new WeakMap,B=new WeakMap,X=new WeakMap;const ht=`
    :host {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    :host:has(.another-chart__legend--top) {
      flex-direction: column-reverse;
    }
    canvas {
      width: 100%;
      flex: 1;
      min-height: 0px;
    }
    .another-chart__legend {
    width: 100%;
    padding: 6px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    font-size: 12px;
    font-family: sans-serif;
  }
  .legend__item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .legend__color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  
  .another-chart__tooltip { 
      position: absolute;
      background: #666;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
      z-index: 10;
      display: none;
      font-family: sans-serif;
    }
    .another-chart__tooltip--animate {
      transition: all ease .2s;
    }
  `;class ct extends HTMLElement{constructor(){super();y(this,H,[]);y(this,G,!1);y(this,Y,!1);y(this,K,[]);y(this,x);y(this,I);z(this,"_observer");z(this,"_resizeObserver");this.attachShadow({mode:"open"}),this.setupElements(),this.setupObservers(),this.setupListeners()}static get observedAttributes(){return["labels"]}setupElements(){var s;const t=document.createElement("style");t.textContent=ht,f(this,x,document.createElement("canvas")),f(this,I,i(this,x).getContext("2d"));const e=document.createElement("slot");(s=this.shadowRoot)==null||s.append(t,i(this,x),e)}setupObservers(){this._observer=new MutationObserver(()=>this.renderAllCharts()),this._observer.observe(this,{childList:!0,subtree:!0,attributes:!0}),this._resizeObserver=new ResizeObserver(()=>this.renderAllCharts()),this._resizeObserver.observe(this)}setupListeners(){this.addEventListener("register-click-area",t=>{const e=t.detail;i(this,K).push(e)}),i(this,x).addEventListener("click",this.handleClick.bind(this))}connectedCallback(){f(this,H,(this.getAttribute("labels")??"").split(",").map(t=>t.trim())),f(this,G,(this.getAttribute("begin-at-zero")??this.getAttribute("beginAtZero")??"true")==="true"),setTimeout(()=>this.renderAllCharts(),0)}attributeChangedCallback(t,e,s){if(console.log(`Attribute changed: ${t} from ${e} to ${s}`),!(!i(this,x)||!i(this,I))&&e!==s&&t==="labels"){const r=(s??"").split(",").map(o=>o.trim()),h=r.length===i(this,H).length;if(f(this,H,r),h){this.drawScales();return}this.renderAllCharts()}}disconnectedCallback(){this._observer&&this._observer.disconnect(),this._resizeObserver&&this._resizeObserver.disconnect()}handleClick(t){const e=i(this,x).getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top,h=i(this,K).find(o=>s>=o.x&&s<=o.x+o.width&&r>=o.y&&r<=o.y+o.height);h&&(console.log("Clicked value:",h.value),this.dispatchEvent(new CustomEvent("value-click",{detail:{value:h.value},bubbles:!0,composed:!0})))}renderAllCharts(){const t=Array.from(this.querySelectorAll("ac-data-set"));f(this,Y,Array.from(this.querySelectorAll("ac-bar-chart")).length>0),t.forEach(e=>{var s;return(s=e.updateData)==null?void 0:s.call(e)}),this.drawScales(),t.forEach(e=>{var s;return(s=e.forceResize)==null?void 0:s.call(e)})}drawScales(){const t=i(this,x).clientWidth??800,e=i(this,x).clientHeight??400;nt(i(this,x),i(this,I),t,e,this.getGlobals().min,this.getGlobals().max,i(this,G)),rt(i(this,I),t,e,i(this,H),i(this,Y))}beginAtZero(){return i(this,G)}getNumberOfValues(){var t;return((t=i(this,H))==null?void 0:t.length)??0}getLabels(){return i(this,H)}getCenter(){return i(this,Y)}getGlobals(){let t=[];return Array.from(this.children).forEach(e=>{var r;const s=JSON.parse(e.getAttribute("data")||"[]");t.push(...s.slice(0,((r=i(this,H))==null?void 0:r.length)||s.length))}),t=[...new Set(t)].toSorted((e,s)=>e-s),{min:t.at(0)??0,max:t.at(-1)??0}}}H=new WeakMap,G=new WeakMap,Y=new WeakMap,K=new WeakMap,x=new WeakMap,I=new WeakMap,customElements.define("another-chart",ct),customElements.define("ac-data-set",p),customElements.define("ac-line-chart",lt),customElements.define("ac-tooltip",V),customElements.define("ac-legend",it),customElements.define("ac-bar-chart",at)});
